context("cir")

test_that("cir_query()", {
  skip_on_cran()

  Sys.sleep(5)
  expect_equal(cir_query('Triclosan', 'mw', verbose = FALSE)[[1]], 289.5451)
  Sys.sleep(5)
  expect_equal(cir_query('xxxxxxx', 'mw', verbose = FALSE)[[1]], NA)
  Sys.sleep(5)
  expect_equal(cir_query("3380-34-5", 'stdinchikey', resolver = 'cas_number', verbose = FALSE)[[1]],
            "InChIKey=XEFQLINVKFYRCS-UHFFFAOYSA-N")
  Sys.sleep(5)
  expect_true(length(cir_query('Triclosan', 'cas', verbose = FALSE)[[1]]) > 1)
  Sys.sleep(5)
  expect_equal(length(cir_query('Triclosan', 'cas', first = TRUE, verbose = FALSE)[[1]]), 1)
  Sys.sleep(5)
  expect_equal(length(cir_query(c('Triclosan', 'Aspirin'), 'cas', verbose = FALSE)), 2)

  Sys.sleep(5)
  expect_equal(cir_query('acetic acid', 'mw', first = TRUE), c(`acetic acid` = 60.0524))
})

test_that("cir_query() doesn't mistake NA for sodium", {
  Sys.sleep(5)
  expect_true(is.na(cir_query(as.character(NA), 'cas')))
})

test_that("cir_img()", {
  skip_on_cran()

  Sys.sleep(5)
  expect_error(cir_img('Glyphosate', dir = NULL))
  Sys.sleep(5)
  expect_s3_class(cir_img('Isoproturon', dir = tempdir()), 'data.frame')
  Sys.sleep(5)
  expect_equal(nrow(cir_img(c('Metamitron', 'Diclofenac'), dir = tempdir())), 2)
})

